var y=Object.defineProperty;var x=(l,t,e)=>t in l?y(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var d=(l,t,e)=>x(l,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class T{constructor(){d(this,"dom");d(this,"state");d(this,"config");d(this,"wakeLock");d(this,"audioContext");d(this,"lastTapTime");d(this,"longPressTimer");d(this,"idleTimer");this.dom={circle:document.getElementById("circle"),countdown:document.getElementById("countdown"),decreaseBtn:document.getElementById("decrease-btn"),increaseBtn:document.getElementById("increase-btn"),durationDisplay:document.getElementById("duration-display"),startBtn:document.getElementById("start-btn"),audioBtn:document.getElementById("audio-btn"),phaseText:document.getElementById("phase-text"),progressCircle:document.querySelector(".progress-ring circle"),sessionTimer:document.getElementById("session-timer"),settingsOverlay:document.getElementById("settings-overlay"),settingsBtn:document.getElementById("settings-btn"),closeSettingsBtn:document.getElementById("close-settings-btn"),zenModeToggle:document.getElementById("zen-mode-toggle")},this.state={isRunning:!1,isMuted:!1,baseDuration:6,currentPhase:0,phaseStartTime:0,animationFrameId:null,sessionMinutes:15,sessionEndTime:null,isZenModeEnabled:!1,currentPresetId:"box"};const t=[{id:"box",name:"Box",description:"Focus & Stress Relief",phases:["Inhale","Hold","Exhale","Hold"],phaseClasses:["inhale","hold","exhale","hold-small"],ratios:[1,1,1,1]},{id:"relax",name:"Relax",description:"Sleep Aid (4-7-8)",phases:["Inhale","Hold","Exhale"],phaseClasses:["inhale","hold","exhale"],ratios:[4,7,8]},{id:"calm",name:"Calm",description:"Balance (4-2-4)",phases:["Inhale","Hold","Exhale"],phaseClasses:["inhale","hold","exhale"],ratios:[4,2,4]},{id:"simple",name:"Simple",description:"Natural Breathing",phases:["Inhale","Exhale"],phaseClasses:["inhale","exhale"],ratios:[1,1]}];this.config={presets:t,frequencies:[261.63,392,329.63,196],circleCircumference:283},this.wakeLock=null,this.audioContext=null,this.lastTapTime=0,this.longPressTimer=null,this.idleTimer=null,this.init()}init(){this.dom.sessionTimer.innerHTML=`
            <span class="timer-control" data-action="decrease">âˆ’</span>
            <span id="session-time-display">15:00</span>
            <span class="timer-control" data-action="increase">+</span>
        `,this.dom.sessionTimeDisplay=document.getElementById("session-time-display"),this.injectSettingsUI(),this.addEventListeners(),this.updateDisplay(),this.updateSessionDisplay(),this.initZenModeListener()}injectSettingsUI(){const t=this.dom.decreaseBtn.closest(".setting-item");if(!t)return;const e=document.createElement("div");e.className="setting-item mobile-layout-fix",e.innerHTML=`
            <div class="setting-label">
                <span>Pattern Mode</span>
            </div>
            <div class="segmented-control" id="pattern-selector">
                ${this.config.presets.map(s=>`<button class="segmented-btn ${s.id===this.state.currentPresetId?"active":""}" data-id="${s.id}">${s.name}</button>`).join("")}
            </div>
            <div id="pattern-description" class="pattern-description">
                 Focus & Stress Relief
            </div>
        `,t.insertAdjacentElement("afterend",e),this.dom.patternContainer=e.querySelector("#pattern-selector")}addEventListeners(){var e;this.dom.startBtn.addEventListener("click",()=>this.toggle()),this.dom.audioBtn.addEventListener("click",()=>this.toggleAudio()),this.dom.decreaseBtn.addEventListener("click",()=>this.changeDuration(-.5)),this.dom.increaseBtn.addEventListener("click",()=>this.changeDuration(.5)),document.addEventListener("keydown",s=>s.key==="Enter"&&this.dom.startBtn.click());const t=async()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume();const s=this.audioContext.createBuffer(1,1,22050),i=this.audioContext.createBufferSource();i.buffer=s,i.connect(this.audioContext.destination),i.start(0),document.body.removeEventListener("touchstart",t),document.body.removeEventListener("click",t)};document.body.addEventListener("touchstart",t,{once:!0}),document.body.addEventListener("click",t,{once:!0}),document.body.addEventListener("keydown",t,{once:!0}),this.dom.sessionTimer.addEventListener("click",s=>{const i=s.target;i.dataset.action==="decrease"&&this.adjustSessionTime(-5),i.dataset.action==="increase"&&this.adjustSessionTime(5)}),this.dom.settingsBtn.addEventListener("click",()=>this.toggleSettings(!0)),this.dom.closeSettingsBtn.addEventListener("click",()=>this.toggleSettings(!1)),this.dom.settingsOverlay.addEventListener("click",s=>{s.target===this.dom.settingsOverlay&&this.toggleSettings(!1)}),this.dom.zenModeToggle.addEventListener("change",s=>{const i=s.target;this.state.isZenModeEnabled=i.checked,this.resetIdleTimer()}),(e=this.dom.patternContainer)==null||e.addEventListener("click",s=>{const i=s.target.closest(".segmented-btn");if(!i)return;this.dom.patternContainer.querySelectorAll(".segmented-btn").forEach(c=>c.classList.remove("active")),i.classList.add("active"),this.setPreset(i.dataset.id);const n=this.config.presets.find(c=>c.id===i.dataset.id),r=this.dom.patternContainer.parentElement.querySelector("#pattern-description");r&&n&&(r.textContent=n.description)}),this.dom.circle.addEventListener("dblclick",()=>this.startSession(15)),this.addLongPressListener(this.dom.circle,()=>this.startSession(15)),this.dom.circle.addEventListener("touchstart",s=>{const i=new Date().getTime();i-this.lastTapTime<300&&(this.startSession(15),s.preventDefault()),this.lastTapTime=i})}setPreset(t){this.state.currentPresetId=t,this.state.isRunning&&(this.stop(),this.updateDisplay())}addLongPressListener(t,e){const s=()=>{this.longPressTimer=setTimeout(()=>{e(),this.triggerHaptic()},1500)},i=()=>{this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)};t.addEventListener("touchstart",s,{passive:!0}),t.addEventListener("touchend",i),t.addEventListener("touchmove",i),t.addEventListener("mousedown",s),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i)}adjustSessionTime(t){if(this.state.sessionMinutes+=t,this.state.sessionMinutes<1&&(this.state.sessionMinutes=1),this.state.isRunning&&this.state.sessionEndTime){this.state.sessionEndTime+=t*60*1e3;const e=performance.now();this.state.sessionEndTime<e+1e4&&(this.state.sessionEndTime=e+1e4)}this.updateSessionDisplay(),this.triggerHaptic()}updateSessionDisplay(){let t=this.state.sessionMinutes,e=0;if(this.state.isRunning&&this.state.sessionEndTime){const i=performance.now(),n=Math.max(0,Math.ceil((this.state.sessionEndTime-i)/1e3));t=Math.floor(n/60),e=n%60}const s=`${t}:${e.toString().padStart(2,"0")} `;this.dom.sessionTimeDisplay&&(this.dom.sessionTimeDisplay.textContent=s)}startSession(t){this.state.sessionMinutes=t,this.updateSessionDisplay(),this.start()}changeDuration(t){const e=this.state.baseDuration;let s=e+t;if(s=Math.max(3,Math.min(30,s)),s!==e&&(this.state.baseDuration=s,this.updateDisplay(),this.state.isRunning)){const i=performance.now(),a=(i-this.state.phaseStartTime)/1e3/e;this.state.phaseStartTime=i-a*this.state.baseDuration*1e3}}updateDisplay(){this.dom.durationDisplay.textContent=`${this.state.baseDuration.toFixed(1)} s`}async toggle(){this.state.isRunning?this.stop():await this.start()}async start(){this.state.isRunning=!0;const t=performance.now();this.state.sessionEndTime=t+this.state.sessionMinutes*60*1e3,this.updateSessionDisplay(),this.dom.startBtn.textContent="Stop",this.dom.startBtn.classList.add("stop"),this.dom.circle.style.transform="scale(0.35)",this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume(),await this.requestWakeLock(),this.startBreathing(),this.resetIdleTimer()}stop(){this.state.isRunning=!1,this.state.animationFrameId!==null&&cancelAnimationFrame(this.state.animationFrameId),this.dom.startBtn.textContent="Start",this.dom.startBtn.classList.remove("stop"),this.dom.circle.className="circle stopped",this.dom.circle.style.removeProperty("--scale"),this.state.sessionEndTime=null,this.updateSessionDisplay(),this.animateText("Box Breathing"),this.dom.countdown.textContent="",this.dom.progressCircle.style.strokeDashoffset=this.config.circleCircumference.toString(),this.releaseWakeLock()}startBreathing(){this.state.phaseStartTime=performance.now(),this.state.currentPhase=-1,this.nextPhase(),this.loop()}loop(){if(!this.state.isRunning)return;const e=(performance.now()-this.state.phaseStartTime)/1e3,s=this.config.presets.find(r=>r.id===this.state.currentPresetId),i=s.ratios[this.state.currentPhase],a=this.state.baseDuration/s.ratios[0]*i;e>=a?this.nextPhase():this.updateUI(e,a),this.state.animationFrameId=requestAnimationFrame(()=>this.loop())}nextPhase(){const t=this.config.presets.find(s=>s.id===this.state.currentPresetId);this.state.currentPhase=(this.state.currentPhase+1)%t.phases.length,this.state.phaseStartTime=performance.now();const e=t.phaseClasses[this.state.currentPhase];this.dom.circle.className=`circle ${e} `,this.dom.circle.style.setProperty("--dur",`${this.state.baseDuration}s`),this.dom.circle.style.removeProperty("--scale"),this.animateText(t.phases[this.state.currentPhase]);try{this.playPhaseSound(this.state.currentPhase),(this.state.currentPhase===0||this.state.currentPhase===2)&&this.playDeepPush(),this.triggerHaptic()}catch(s){console.warn("Audio feedback error:",s)}}updateUI(t,e){const s=Math.max(0,e-t);this.dom.countdown.textContent=Math.ceil(s).toString()||"";const i=t/e,n=Math.max(0,Math.min(1,i)),a=this.config.presets.find(o=>o.id===this.state.currentPresetId),r=a.phases[this.state.currentPhase];let c=.35;if(r==="Inhale")c=.35+.65*this.easeInOut(n);else if(r==="Exhale")c=1-.65*this.easeInOut(n);else if(r==="Hold"){const o=(this.state.currentPhase-1+a.phases.length)%a.phases.length;a.phases[o]==="Inhale"?c=1+.02*Math.sin(t*2.5):c=.35+.01*Math.sin(t*2.5)}this.dom.circle.style.transform=`scale(${c}) translateZ(0)`;const u=this.state.baseDuration/a.ratios[0],p=a.ratios.reduce((o,h)=>o+h,0)*u;let m=0;for(let o=0;o<this.state.currentPhase;o++)m+=a.ratios[o]*u;const g=(m+t)/p,f=this.config.circleCircumference*(1-g);if(this.dom.progressCircle.style.strokeDashoffset=f.toString(),this.state.sessionEndTime){const o=performance.now();if(Math.max(0,Math.ceil((this.state.sessionEndTime-o)/1e3))<=0){this.playGong(),this.stop();return}this.updateSessionDisplay()}}playGong(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.currentTime,e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.frequency.value=100,e.type="triangle",s.gain.setValueAtTime(0,t),s.gain.linearRampToValueAtTime(.6,t+.2),s.gain.exponentialRampToValueAtTime(.001,t+5);const i=this.audioContext.createBiquadFilter();i.type="lowpass",i.frequency.value=300,e.connect(i),i.connect(s),s.connect(this.audioContext.destination),e.start(t),e.stop(t+6)}playPhaseSound(t){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination);const i=this.audioContext.currentTime,a=this.config.presets.find(r=>r.id===this.state.currentPresetId).phases[t];s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.3,i+.1),s.gain.exponentialRampToValueAtTime(.001,i+1.5),e.type="sine",a==="Inhale"?e.frequency.value=174.61:a==="Exhale"?e.frequency.value=130.81:e.frequency.value=146.83,e.start(i),e.stop(i+1.5)}toggleAudio(){this.state.isMuted=!this.state.isMuted,this.dom.audioBtn.classList.toggle("muted",this.state.isMuted);const t=this.state.isMuted?"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z":"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z";this.dom.audioBtn.querySelector("path").setAttribute("d",t)}playDeepPush(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination);const s=this.audioContext.currentTime;t.frequency.setValueAtTime(150,s),t.frequency.exponentialRampToValueAtTime(50,s+.15),e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(.8,s+.02),e.gain.exponentialRampToValueAtTime(.001,s+.5),t.start(s),t.stop(s+.5)}triggerHaptic(){const t=this.state.currentPhase===0||this.state.currentPhase===2,e=[30];navigator.vibrate&&navigator.vibrate(e),!navigator.vibrate&&this.audioContext&&!this.state.isMuted&&this.playHapticSound(t)}playHapticSound(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination),e.frequency.value=60;const i=this.audioContext.currentTime,n=t?.08:.04;s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(1,i+.01),s.gain.exponentialRampToValueAtTime(.01,i+n),e.start(i),e.stop(i+n)}requestWakeLock(){if("wakeLock"in navigator)try{navigator.wakeLock.request("screen")}catch{}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release()}toggleSettings(t){t?this.dom.settingsOverlay.classList.remove("hidden"):this.dom.settingsOverlay.classList.add("hidden")}initZenModeListener(){this.idleTimer=null;const t=()=>this.resetIdleTimer();["mousemove","mousedown","touchstart","click","keydown"].forEach(e=>document.addEventListener(e,t,{passive:!0}))}resetIdleTimer(){document.body.classList.remove("zen-mode"),this.idleTimer&&clearTimeout(this.idleTimer),this.state.isRunning&&this.state.isZenModeEnabled&&(this.idleTimer=setTimeout(()=>{document.body.classList.add("zen-mode")},5e3))}animateText(t){const e=this.dom.phaseText;e.classList.add("text-fade-out"),setTimeout(()=>{e.textContent=t,e.classList.remove("text-fade-out"),e.classList.add("text-fade-in"),setTimeout(()=>e.classList.remove("text-fade-in"),500)},250)}easeInOut(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}}new T;
