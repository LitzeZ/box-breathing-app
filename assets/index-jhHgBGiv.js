var v=Object.defineProperty;var x=(g,t,e)=>t in g?v(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var m=(g,t,e)=>x(g,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class C{constructor(){m(this,"dom");m(this,"state");m(this,"config");m(this,"wakeLock");m(this,"audioContext");m(this,"soundscapeContext");m(this,"soundscapeGain");m(this,"soundscapeSource");m(this,"lastTapTime");m(this,"longPressTimer");m(this,"idleTimer");this.dom={circle:document.getElementById("circle"),countdown:document.getElementById("countdown"),decreaseBtn:document.getElementById("decrease-btn"),increaseBtn:document.getElementById("increase-btn"),durationDisplay:document.getElementById("duration-display"),startBtn:document.getElementById("start-btn"),audioBtn:document.getElementById("audio-btn"),phaseText:document.getElementById("phase-text"),progressCircle:document.querySelector(".progress-ring circle"),sessionTimer:document.getElementById("session-timer"),settingsOverlay:document.getElementById("settings-overlay"),settingsBtn:document.getElementById("settings-btn"),closeSettingsBtn:document.getElementById("close-settings-btn"),zenModeToggle:document.getElementById("zen-mode-toggle"),streakBadge:document.getElementById("streak-badge"),streakCount:document.querySelector(".streak-count")},this.state={isRunning:!1,isMuted:!1,baseDuration:6,currentPhase:0,phaseStartTime:0,animationFrameId:null,sessionMinutes:15,sessionEndTime:null,isZenModeEnabled:!1,streak:0,lastVisit:null,currentPresetId:"box",currentSoundscapeId:"none"};const t=[{id:"box",name:"Box",description:"Focus & Stress Relief",phases:["Inhale","Hold","Exhale","Hold"],phaseClasses:["inhale","hold","exhale","hold-small"],ratios:[1,1,1,1]},{id:"relax",name:"Relax",description:"Sleep Aid (4-7-8)",phases:["Inhale","Hold","Exhale"],phaseClasses:["inhale","hold","exhale"],ratios:[4,7,8]},{id:"calm",name:"Calm",description:"Balance (4-2-4)",phases:["Inhale","Hold","Exhale"],phaseClasses:["inhale","hold","exhale"],ratios:[4,2,4]},{id:"simple",name:"Simple",description:"Natural Breathing",phases:["Inhale","Exhale"],phaseClasses:["inhale","exhale"],ratios:[1,1]}];this.config={presets:t,frequencies:[261.63,392,329.63,196],circleCircumference:283},this.wakeLock=null,this.audioContext=null,this.soundscapeContext=null,this.soundscapeGain=null,this.soundscapeSource=null,this.lastTapTime=0,this.longPressTimer=null,this.idleTimer=null,this.init(),this.loadStreak()}init(){this.dom.sessionTimer.innerHTML=`
            <span class="timer-control" data-action="decrease">âˆ’</span>
            <span id="session-time-display">15:00</span>
            <span class="timer-control" data-action="increase">+</span>
        `,this.dom.sessionTimeDisplay=document.getElementById("session-time-display"),this.injectSettingsUI(),this.addEventListeners(),this.updateDisplay(),this.updateSessionDisplay(),this.initZenModeListener()}injectSettingsUI(){const t=this.dom.decreaseBtn.closest(".setting-item");if(!t)return;const e=document.createElement("div");e.className="setting-item mobile-layout-fix",e.innerHTML=`
            <div class="setting-label">
                <span>Pattern</span>
                <button class="icon-btn tiny" id="pattern-info-btn" aria-label="Pattern Info">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                    </svg>
                </button>
            </div>
            <div id="pattern-description" class="pattern-description">
                 Focus & Stress Relief
            </div>
            <div class="segmented-control" id="pattern-selector">
                ${this.config.presets.map(i=>`<button class="segmented-btn ${i.id===this.state.currentPresetId?"active":""}" data-id="${i.id}">${i.name}</button>`).join("")}
            </div>
        `,t.insertAdjacentElement("afterend",e),this.dom.patternContainer=e.querySelector("#pattern-selector");const s=document.createElement("div");s.className="setting-item mobile-layout-fix",s.innerHTML=`
             <div class="setting-label" style="flex: 0 0 100%;">
                <span>Soundscape</span>
                <div class="soundscape-grid" id="soundscape-selector">
                    <button class="sound-btn active" data-id="none">
                        <svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                        <span>Off</span>
                    </button>
                    <button class="sound-btn" data-id="rain">
                        <svg viewBox="0 0 24 24"><path d="M4.03 12c.73-3.04 3.46-5.28 6.72-5.28 2.37 0 4.45 1.18 5.74 2.97.45-.16.91-.25 1.39-.27L17.85 7C17.7 5.09 16.36 3.46 14.59 2.76A8 8 0 0 0 4 11.23L4.03 12zM12.92 7.02c-.08-.01-.16-.02-.24-.02-3.1 0-5.63 2.53-5.63 5.63 0 .42.06.82.14 1.21l1.76-1.76c-.05-.33-.09-.67-.09-1.01 0-2.31 1.76-4.2 4.07-4.2.34 0 .68.04 1.01.09l-1.02-1.02v.08zM19 19h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm-8 0H5c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm4-4h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm4-4h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1z"/></svg>
                        <span>Rain</span>
                    </button>
                    <button class="sound-btn" data-id="wind">
                        <svg viewBox="0 0 24 24"><path d="M12.65 19.16l-2.77-3.92a2.33 2.33 0 0 0-3.8 0l-2.77 3.92a.5.5 0 0 0 .41.79h8.52a.5.5 0 0 0 .41-.79zm5.32 0l-1.6-2.26-1.6 2.26a.5.5 0 0 0 .41.79h2.38a.5.5 0 0 0 .41-.79zm-7.97-6.32l-1.6-2.26-1.6 2.26a.5.5 0 0 0 .41.79h2.38a.5.5 0 0 0 .41-.79zM17 10l-3.75 5 2.85 3.8-1.6 1.2C12.81 17.75 10 14 10 14l-6 8h22L17 10z" style="display:none;"/><path d="M19.18 10.99c-2.43 0-4.63 1.39-5.75 3.44l-1.46-2.07c1.37-2.58 4.07-4.37 7.21-4.37 1.63 0 3.16.51 4.45 1.38l1.45-2.06A14.9 14.9 0 0 0 19.18 6C13.84 6 9.17 9 6.8 13.52L5.86 12.2c1.78-4 5.75-6.86 10.4-7.14V3l4 4-4 4V9.07c-3.13.25-5.84 2.05-7.33 4.67l-1.46-2.07c1.88-3.05 5.16-5.09 8.91-5.09 1.13 0 2.21.23 3.23.64l1.45-2.06c-1.35-.55-2.8-.87-4.31-.87z"/></svg>
                        <span>Wind</span>
                    </button>
                </div>
            </div>
        `,e.insertAdjacentElement("afterend",s),this.dom.soundscapeContainer=s.querySelector("#soundscape-selector")}addEventListeners(){var s,i,o;this.dom.startBtn.addEventListener("click",()=>this.toggle()),this.dom.audioBtn.addEventListener("click",()=>this.toggleAudio()),this.dom.decreaseBtn.addEventListener("click",()=>this.changeDuration(-.5)),this.dom.increaseBtn.addEventListener("click",()=>this.changeDuration(.5)),document.addEventListener("keydown",n=>n.key==="Enter"&&this.dom.startBtn.click());const t=async()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.soundscapeContext||(this.soundscapeContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.soundscapeContext.state==="suspended"&&await this.soundscapeContext.resume();const n=this.audioContext.createBuffer(1,1,22050),a=this.audioContext.createBufferSource();a.buffer=n,a.connect(this.audioContext.destination),a.start(0),document.body.removeEventListener("touchstart",t),document.body.removeEventListener("click",t)};document.body.addEventListener("touchstart",t,{once:!0}),document.body.addEventListener("click",t,{once:!0}),document.body.addEventListener("keydown",t,{once:!0}),this.dom.sessionTimer.addEventListener("click",n=>{const a=n.target;a.dataset.action==="decrease"&&this.adjustSessionTime(-5),a.dataset.action==="increase"&&this.adjustSessionTime(5)}),this.dom.settingsBtn.addEventListener("click",()=>this.toggleSettings(!0)),this.dom.closeSettingsBtn.addEventListener("click",()=>this.toggleSettings(!1)),this.dom.settingsOverlay.addEventListener("click",n=>{n.target===this.dom.settingsOverlay&&this.toggleSettings(!1)}),this.dom.zenModeToggle.addEventListener("change",n=>{const a=n.target;this.state.isZenModeEnabled=a.checked,this.resetIdleTimer()}),(s=this.dom.patternContainer)==null||s.addEventListener("click",n=>{const a=n.target.closest(".segmented-btn");if(!a)return;this.dom.patternContainer.querySelectorAll(".segmented-btn").forEach(c=>c.classList.remove("active")),a.classList.add("active"),this.setPreset(a.dataset.id);const r=this.config.presets.find(c=>c.id===a.dataset.id),d=this.dom.patternContainer.parentElement.querySelector("#pattern-description");d&&r&&(d.textContent=r.description)});const e=(i=this.dom.patternContainer)==null?void 0:i.parentElement;if(e){const n=e.querySelector("#pattern-info-btn"),a=e.querySelector("#pattern-description");n==null||n.addEventListener("click",()=>{a==null||a.classList.toggle("visible")})}(o=this.dom.soundscapeContainer)==null||o.addEventListener("click",n=>{const a=n.target.closest(".sound-btn");a&&(this.dom.soundscapeContainer.querySelectorAll(".sound-btn").forEach(r=>r.classList.remove("active")),a.classList.add("active"),this.setSoundscape(a.dataset.id))}),this.dom.circle.addEventListener("dblclick",()=>this.startSession(15)),this.addLongPressListener(this.dom.circle,()=>this.startSession(15)),this.dom.circle.addEventListener("touchstart",n=>{const a=new Date().getTime();a-this.lastTapTime<300&&(this.startSession(15),n.preventDefault()),this.lastTapTime=a})}setPreset(t){this.state.currentPresetId=t,this.state.isRunning&&(this.stop(),this.updateDisplay())}setSoundscape(t){this.state.currentSoundscapeId=t,this.state.isRunning&&!this.state.isMuted&&this.playBackgroundSound()}addLongPressListener(t,e){const s=()=>{this.longPressTimer=setTimeout(()=>{e(),this.triggerHaptic()},1500)},i=()=>{this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)};t.addEventListener("touchstart",s,{passive:!0}),t.addEventListener("touchend",i),t.addEventListener("touchmove",i),t.addEventListener("mousedown",s),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i)}adjustSessionTime(t){if(this.state.sessionMinutes+=t,this.state.sessionMinutes<1&&(this.state.sessionMinutes=1),this.state.isRunning&&this.state.sessionEndTime){this.state.sessionEndTime+=t*60*1e3;const e=performance.now();this.state.sessionEndTime<e+1e4&&(this.state.sessionEndTime=e+1e4)}this.updateSessionDisplay(),this.triggerHaptic()}updateSessionDisplay(){let t=this.state.sessionMinutes,e=0;if(this.state.isRunning&&this.state.sessionEndTime){const i=performance.now(),o=Math.max(0,Math.ceil((this.state.sessionEndTime-i)/1e3));t=Math.floor(o/60),e=o%60}const s=`${t}:${e.toString().padStart(2,"0")} `;this.dom.sessionTimeDisplay&&(this.dom.sessionTimeDisplay.textContent=s)}startSession(t){this.state.sessionMinutes=t,this.updateSessionDisplay(),this.start()}changeDuration(t){const e=this.state.baseDuration;let s=e+t;if(s=Math.max(3,Math.min(30,s)),s!==e&&(this.state.baseDuration=s,this.updateDisplay(),this.state.isRunning)){const i=performance.now(),n=(i-this.state.phaseStartTime)/1e3/e;this.state.phaseStartTime=i-n*this.state.baseDuration*1e3}}updateDisplay(){this.dom.durationDisplay.textContent=`${this.state.baseDuration.toFixed(1)} s`}async toggle(){this.state.isRunning?this.stop():await this.start()}async start(){this.state.isRunning=!0;const t=performance.now();this.state.sessionEndTime=t+this.state.sessionMinutes*60*1e3,this.updateSessionDisplay(),this.dom.startBtn.textContent="Stop",this.dom.startBtn.classList.add("stop"),this.dom.circle.style.transform="scale(0.35)",this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.soundscapeContext||(this.soundscapeContext=new(window.AudioContext||window.webkitAudioContext)),this.soundscapeContext.state==="suspended"&&await this.soundscapeContext.resume(),await this.requestWakeLock(),this.startBreathing(),this.playBackgroundSound(),this.resetIdleTimer()}stop(){this.state.isRunning=!1,this.state.animationFrameId!==null&&cancelAnimationFrame(this.state.animationFrameId),this.dom.startBtn.textContent="Start",this.dom.startBtn.classList.remove("stop"),this.dom.circle.className="circle stopped",this.dom.circle.style.removeProperty("--scale"),this.state.sessionEndTime=null,this.updateSessionDisplay(),this.animateText("Box Breathing"),this.dom.countdown.textContent="",this.dom.progressCircle.style.strokeDashoffset=this.config.circleCircumference.toString(),this.stopBackgroundSound(),this.releaseWakeLock()}startBreathing(){this.state.phaseStartTime=performance.now(),this.state.currentPhase=-1,this.nextPhase(),this.loop()}loop(){if(!this.state.isRunning)return;const e=(performance.now()-this.state.phaseStartTime)/1e3,s=this.config.presets.find(a=>a.id===this.state.currentPresetId),i=s.ratios[this.state.currentPhase],n=this.state.baseDuration/s.ratios[0]*i;e>=n?this.nextPhase():this.updateUI(e,n),this.state.animationFrameId=requestAnimationFrame(()=>this.loop())}nextPhase(){const t=this.config.presets.find(s=>s.id===this.state.currentPresetId);this.state.currentPhase=(this.state.currentPhase+1)%t.phases.length,this.state.phaseStartTime=performance.now();const e=t.phaseClasses[this.state.currentPhase];this.dom.circle.className=`circle ${e} `,this.dom.circle.style.setProperty("--dur",`${this.state.baseDuration}s`),this.dom.circle.style.removeProperty("--scale"),this.animateText(t.phases[this.state.currentPhase]);try{this.playPhaseSound(this.state.currentPhase),(this.state.currentPhase===0||this.state.currentPhase===2)&&this.playDeepPush(),this.triggerHaptic()}catch(s){console.warn("Audio feedback error:",s)}}updateUI(t,e){const s=Math.max(0,e-t);this.dom.countdown.textContent=Math.ceil(s).toString()||"";const i=t/e,o=Math.max(0,Math.min(1,i)),n=this.config.presets.find(l=>l.id===this.state.currentPresetId),a=n.phases[this.state.currentPhase];let r=.35;if(a==="Inhale")r=.35+.65*this.easeInOut(o);else if(a==="Exhale")r=1-.65*this.easeInOut(o);else if(a==="Hold"){const l=(this.state.currentPhase-1+n.phases.length)%n.phases.length;n.phases[l]==="Inhale"?r=1+.02*Math.sin(t*2.5):r=.35+.01*Math.sin(t*2.5)}this.dom.circle.style.transform=`scale(${r}) translateZ(0)`;const u=this.state.baseDuration/n.ratios[0],d=n.ratios.reduce((l,h)=>l+h,0)*u;let c=0;for(let l=0;l<this.state.currentPhase;l++)c+=n.ratios[l]*u;const f=(c+t)/d,y=this.config.circleCircumference*(1-f);if(this.dom.progressCircle.style.strokeDashoffset=y.toString(),this.state.sessionEndTime){const l=performance.now();if(Math.max(0,Math.ceil((this.state.sessionEndTime-l)/1e3))<=0){this.updateStreak(),this.playGong(),this.stop();return}this.updateSessionDisplay()}}playGong(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.currentTime,e=[180,240,320,560],s=[.4,.3,.2,.1],i=[3,2.5,2,4];e.forEach((o,n)=>{const a=this.audioContext.createOscillator(),r=this.audioContext.createGain();a.frequency.value=o,a.type=n===0?"triangle":"sine",r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(s[n],t+.05),r.gain.exponentialRampToValueAtTime(.001,t+i[n]),a.connect(r),r.connect(this.audioContext.destination),a.start(t),a.stop(t+i[n]+.1)})}playPhaseSound(t){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination);const i=this.audioContext.currentTime,n=this.config.presets.find(a=>a.id===this.state.currentPresetId).phases[t];s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.3,i+.1),s.gain.exponentialRampToValueAtTime(.001,i+1.5),e.type="sine",n==="Inhale"?e.frequency.value=174.61:n==="Exhale"?e.frequency.value=130.81:e.frequency.value=146.83,e.start(i),e.stop(i+1.5)}playBackgroundSound(){if(this.stopBackgroundSound(),this.state.currentSoundscapeId==="none"||!this.soundscapeContext||this.state.isMuted)return;this.soundscapeContext.state==="suspended"&&this.soundscapeContext.resume();const t=this.soundscapeContext;this.soundscapeGain=t.createGain(),this.soundscapeGain.connect(t.destination),this.soundscapeGain.gain.value=.05,this.state.currentSoundscapeId==="rain"?this.createPinkNoise(t,this.soundscapeGain):this.state.currentSoundscapeId==="wind"&&this.createForestWind(t,this.soundscapeGain)}stopBackgroundSound(){var t;if(this.soundscapeGain){const e=((t=this.soundscapeContext)==null?void 0:t.currentTime)||0;this.soundscapeGain.gain.exponentialRampToValueAtTime(1e-4,e+.5),setTimeout(()=>{var s;(s=this.soundscapeSource)==null||s.disconnect(),this.soundscapeSource=null,this.soundscapeGain=null},600)}}createPinkNoise(t,e){const s=2*t.sampleRate,i=t.createBuffer(1,s,t.sampleRate),o=i.getChannelData(0);let n,a,r,u,d,c,p;n=a=r=u=d=c=p=0;for(let l=0;l<s;l++){const h=Math.random()*2-1;n=.99886*n+h*.0555179,a=.99332*a+h*.0750759,r=.969*r+h*.153852,u=.8665*u+h*.3104856,d=.55*d+h*.5329522,c=-.7616*c-h*.016898,o[l]=n+a+r+u+d+c+p+h*.5362,o[l]*=.11,p=h*.115926}const f=t.createBufferSource();f.buffer=i,f.loop=!0;const y=t.createBiquadFilter();y.type="lowpass",y.frequency.value=800,f.connect(y),y.connect(e),f.start(0),this.soundscapeSource=f}createBrownNoise(t,e){const s=2*t.sampleRate,i=t.createBuffer(1,s,t.sampleRate),o=i.getChannelData(0);let n=0;for(let c=0;c<s;c++){const p=Math.random()*2-1;o[c]=(n+.02*p)/1.02,n=o[c],o[c]*=3.5}const a=t.createBufferSource();a.buffer=i,a.loop=!0;const r=t.createOscillator();r.type="sine",r.frequency.value=.1;const u=t.createGain();u.gain.value=.3;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=400,a.connect(d),d.connect(e),a.start(0),this.soundscapeSource=a}createForestWind(t,e){const s=2*t.sampleRate,i=t.createBuffer(1,s,t.sampleRate),o=i.getChannelData(0);let n=0;for(let c=0;c<s;c++){const p=Math.random()*2-1;o[c]=(n+.02*p)/1.02,n=o[c],o[c]*=3.5}const a=t.createBufferSource();a.buffer=i,a.loop=!0;const r=t.createOscillator();r.type="sine",r.frequency.value=.05;const u=t.createGain();u.gain.value=.4,r.connect(u),u.connect(e.gain);const d=t.createBiquadFilter();d.type="highpass",d.frequency.value=200,a.connect(d),d.connect(e),a.start(0),r.start(0),this.soundscapeSource=a}toggleAudio(){this.state.isMuted=!this.state.isMuted,this.dom.audioBtn.classList.toggle("muted",this.state.isMuted);const t=this.state.isMuted?"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z":"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z";this.dom.audioBtn.querySelector("path").setAttribute("d",t),this.state.isMuted?this.stopBackgroundSound():this.playBackgroundSound()}playDeepPush(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination);const s=this.audioContext.currentTime;t.frequency.setValueAtTime(150,s),t.frequency.exponentialRampToValueAtTime(50,s+.15),e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(.8,s+.02),e.gain.exponentialRampToValueAtTime(.001,s+.5),t.start(s),t.stop(s+.5)}triggerHaptic(){const t=this.state.currentPhase===0||this.state.currentPhase===2,e=[30];navigator.vibrate&&navigator.vibrate(e),!navigator.vibrate&&this.audioContext&&!this.state.isMuted&&this.playHapticSound(t)}playHapticSound(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination),e.frequency.value=60;const i=this.audioContext.currentTime,o=t?.08:.04;s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(1,i+.01),s.gain.exponentialRampToValueAtTime(.01,i+o),e.start(i),e.stop(i+o)}requestWakeLock(){if("wakeLock"in navigator)try{navigator.wakeLock.request("screen")}catch{}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release()}toggleSettings(t){t?this.dom.settingsOverlay.classList.remove("hidden"):this.dom.settingsOverlay.classList.add("hidden")}initZenModeListener(){this.idleTimer=null;const t=()=>this.resetIdleTimer();["mousemove","mousedown","touchstart","click","keydown"].forEach(e=>document.addEventListener(e,t,{passive:!0}))}resetIdleTimer(){document.body.classList.remove("zen-mode"),this.idleTimer&&clearTimeout(this.idleTimer),this.state.isRunning&&this.state.isZenModeEnabled&&(this.idleTimer=setTimeout(()=>{document.body.classList.add("zen-mode")},5e3))}animateText(t){const e=this.dom.phaseText;e.classList.add("text-fade-out"),setTimeout(()=>{e.textContent=t,e.classList.remove("text-fade-out"),e.classList.add("text-fade-in"),setTimeout(()=>e.classList.remove("text-fade-in"),500)},250)}easeInOut(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}loadStreak(){const t=localStorage.getItem("boxBreathingStreak"),e=localStorage.getItem("boxBreathingLastVisit");t&&(this.state.streak=parseInt(t,10)),e&&(this.state.lastVisit=e),this.updateStreakDisplay()}updateStreak(){const t=new Date().toDateString();if(this.state.lastVisit!==t){const e=new Date;e.setDate(e.getDate()-1),this.state.lastVisit===e.toDateString()?this.state.streak++:this.state.streak=1,this.state.lastVisit=t,localStorage.setItem("boxBreathingStreak",this.state.streak.toString()),localStorage.setItem("boxBreathingLastVisit",this.state.lastVisit),this.updateStreakDisplay()}}updateStreakDisplay(){this.state.streak>0?(this.dom.streakBadge.classList.remove("hidden"),this.dom.streakCount.textContent=this.state.streak.toString()):this.dom.streakBadge.classList.add("hidden")}}new C;
