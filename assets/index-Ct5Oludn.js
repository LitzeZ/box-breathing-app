var v=Object.defineProperty;var x=(m,t,e)=>t in m?v(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var c=(m,t,e)=>x(m,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class S{constructor(){c(this,"dom");c(this,"state");c(this,"config");c(this,"wakeLock");c(this,"audioContext");c(this,"soundscapeContext");c(this,"soundscapeGain");c(this,"soundscapeSource");c(this,"lastTapTime");c(this,"longPressTimer");c(this,"idleTimer");this.dom={circle:document.getElementById("circle"),countdown:document.getElementById("countdown"),decreaseBtn:document.getElementById("decrease-btn"),increaseBtn:document.getElementById("increase-btn"),durationDisplay:document.getElementById("duration-display"),startBtn:document.getElementById("start-btn"),audioBtn:document.getElementById("audio-btn"),phaseText:document.getElementById("phase-text"),progressCircle:document.querySelector(".progress-ring circle"),sessionTimer:document.getElementById("session-timer"),settingsOverlay:document.getElementById("settings-overlay"),settingsBtn:document.getElementById("settings-btn"),closeSettingsBtn:document.getElementById("close-settings-btn"),zenModeToggle:document.getElementById("zen-mode-toggle"),streakBadge:document.getElementById("streak-badge"),streakCount:document.querySelector(".streak-count")},this.state={isRunning:!1,isMuted:!1,baseDuration:6,currentPhase:0,phaseStartTime:0,animationFrameId:null,sessionMinutes:15,sessionEndTime:null,isZenModeEnabled:!1,streak:0,lastVisit:null,currentPresetId:"box",currentSoundscapeId:"none"};const t=[{id:"box",name:"Box",phases:["Inhale","Hold","Exhale","Hold"],phaseClasses:["inhale","hold","exhale","hold-small"],ratios:[1,1,1,1]},{id:"simple",name:"Simple",phases:["Inhale","Exhale"],phaseClasses:["inhale","exhale"],ratios:[1,1]}];this.config={presets:t,frequencies:[261.63,392,329.63,196],circleCircumference:283},this.wakeLock=null,this.audioContext=null,this.soundscapeContext=null,this.soundscapeGain=null,this.soundscapeSource=null,this.lastTapTime=0,this.longPressTimer=null,this.idleTimer=null,this.init(),this.loadStreak()}init(){this.dom.sessionTimer.innerHTML=`
            <span class="timer-control" data-action="decrease">âˆ’</span>
            <span id="session-time-display">15:00</span>
            <span class="timer-control" data-action="increase">+</span>
        `,this.dom.sessionTimeDisplay=document.getElementById("session-time-display"),this.injectSettingsUI(),this.addEventListeners(),this.updateDisplay(),this.updateSessionDisplay(),this.initZenModeListener()}injectSettingsUI(){const t=this.dom.decreaseBtn.closest(".setting-item");if(!t)return;const e=document.createElement("div");e.className="setting-item mobile-layout-fix",e.innerHTML=`
            <div class="setting-label">
                <span>Pattern</span>
                <small>Mode</small>
            </div>
            <div class="segmented-control" id="pattern-selector">
                ${this.config.presets.map(s=>`<button class="segmented-btn ${s.id===this.state.currentPresetId?"active":""}" data-id="${s.id}">${s.name}</button>`).join("")}
            </div>
        `,t.insertAdjacentElement("afterend",e),this.dom.patternContainer=e.querySelector("#pattern-selector");const i=document.createElement("div");i.className="setting-item mobile-layout-fix",i.innerHTML=`
             <div class="setting-label" style="flex: 0 0 100%;">
                <span>Soundscape</span>
                <div class="soundscape-grid" id="soundscape-selector">
                    <button class="sound-btn active" data-id="none">
                        <svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                        <span>Off</span>
                    </button>
                    <button class="sound-btn" data-id="rain">
                        <svg viewBox="0 0 24 24"><path d="M4.03 12c.73-3.04 3.46-5.28 6.72-5.28 2.37 0 4.45 1.18 5.74 2.97.45-.16.91-.25 1.39-.27L17.85 7C17.7 5.09 16.36 3.46 14.59 2.76A8 8 0 0 0 4 11.23L4.03 12zM12.92 7.02c-.08-.01-.16-.02-.24-.02-3.1 0-5.63 2.53-5.63 5.63 0 .42.06.82.14 1.21l1.76-1.76c-.05-.33-.09-.67-.09-1.01 0-2.31 1.76-4.2 4.07-4.2.34 0 .68.04 1.01.09l-1.02-1.02v.08zM19 19h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm-8 0H5c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm4-4h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm4-4h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1z"/></svg>
                        <span>Rain</span>
                    </button>
                    <button class="sound-btn" data-id="beach">
                        <svg viewBox="0 0 24 24"><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></svg>
                        <span>Beach</span>
                    </button>
                </div>
            </div>
        `,e.insertAdjacentElement("afterend",i),this.dom.soundscapeContainer=i.querySelector("#soundscape-selector")}addEventListeners(){var e,i;this.dom.startBtn.addEventListener("click",()=>this.toggle()),this.dom.audioBtn.addEventListener("click",()=>this.toggleAudio()),this.dom.decreaseBtn.addEventListener("click",()=>this.changeDuration(-.5)),this.dom.increaseBtn.addEventListener("click",()=>this.changeDuration(.5)),document.addEventListener("keydown",s=>s.key==="Enter"&&this.dom.startBtn.click());const t=async()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.soundscapeContext||(this.soundscapeContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.soundscapeContext.state==="suspended"&&await this.soundscapeContext.resume();const s=this.audioContext.createBuffer(1,1,22050),n=this.audioContext.createBufferSource();n.buffer=s,n.connect(this.audioContext.destination),n.start(0),document.body.removeEventListener("touchstart",t),document.body.removeEventListener("click",t)};document.body.addEventListener("touchstart",t,{once:!0}),document.body.addEventListener("click",t,{once:!0}),document.body.addEventListener("keydown",t,{once:!0}),this.dom.sessionTimer.addEventListener("click",s=>{const n=s.target;n.dataset.action==="decrease"&&this.adjustSessionTime(-5),n.dataset.action==="increase"&&this.adjustSessionTime(5)}),this.dom.settingsBtn.addEventListener("click",()=>this.toggleSettings(!0)),this.dom.closeSettingsBtn.addEventListener("click",()=>this.toggleSettings(!1)),this.dom.settingsOverlay.addEventListener("click",s=>{s.target===this.dom.settingsOverlay&&this.toggleSettings(!1)}),this.dom.zenModeToggle.addEventListener("change",s=>{const n=s.target;this.state.isZenModeEnabled=n.checked,this.resetIdleTimer()}),(e=this.dom.patternContainer)==null||e.addEventListener("click",s=>{const n=s.target.closest(".segmented-btn");n&&(this.dom.patternContainer.querySelectorAll(".segmented-btn").forEach(a=>a.classList.remove("active")),n.classList.add("active"),this.setPreset(n.dataset.id))}),(i=this.dom.soundscapeContainer)==null||i.addEventListener("click",s=>{const n=s.target.closest(".sound-btn");n&&(this.dom.soundscapeContainer.querySelectorAll(".sound-btn").forEach(a=>a.classList.remove("active")),n.classList.add("active"),this.setSoundscape(n.dataset.id))}),this.dom.circle.addEventListener("dblclick",()=>this.startSession(15)),this.addLongPressListener(this.dom.circle,()=>this.startSession(15)),this.dom.circle.addEventListener("touchstart",s=>{const n=new Date().getTime();n-this.lastTapTime<300&&(this.startSession(15),s.preventDefault()),this.lastTapTime=n})}setPreset(t){this.state.currentPresetId=t,this.state.isRunning&&(this.stop(),this.updateDisplay())}setSoundscape(t){this.state.currentSoundscapeId=t,this.state.isRunning&&!this.state.isMuted&&this.playBackgroundSound()}addLongPressListener(t,e){const i=()=>{this.longPressTimer=setTimeout(()=>{e(),this.triggerHaptic()},1500)},s=()=>{this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)};t.addEventListener("touchstart",i,{passive:!0}),t.addEventListener("touchend",s),t.addEventListener("touchmove",s),t.addEventListener("mousedown",i),t.addEventListener("mouseup",s),t.addEventListener("mouseleave",s)}adjustSessionTime(t){if(this.state.sessionMinutes+=t,this.state.sessionMinutes<1&&(this.state.sessionMinutes=1),this.state.isRunning&&this.state.sessionEndTime){this.state.sessionEndTime+=t*60*1e3;const e=performance.now();this.state.sessionEndTime<e+1e4&&(this.state.sessionEndTime=e+1e4)}this.updateSessionDisplay(),this.triggerHaptic()}updateSessionDisplay(){let t=this.state.sessionMinutes,e=0;if(this.state.isRunning&&this.state.sessionEndTime){const s=performance.now(),n=Math.max(0,Math.ceil((this.state.sessionEndTime-s)/1e3));t=Math.floor(n/60),e=n%60}const i=`${t}:${e.toString().padStart(2,"0")} `;this.dom.sessionTimeDisplay&&(this.dom.sessionTimeDisplay.textContent=i)}startSession(t){this.state.sessionMinutes=t,this.updateSessionDisplay(),this.start()}changeDuration(t){const e=this.state.baseDuration;let i=e+t;if(i=Math.max(3,Math.min(30,i)),i!==e&&(this.state.baseDuration=i,this.updateDisplay(),this.state.isRunning)){const s=performance.now(),a=(s-this.state.phaseStartTime)/1e3/e;this.state.phaseStartTime=s-a*this.state.baseDuration*1e3}}updateDisplay(){this.dom.durationDisplay.textContent=`${this.state.baseDuration.toFixed(1)} s`}async toggle(){this.state.isRunning?this.stop():await this.start()}async start(){this.state.isRunning=!0;const t=performance.now();this.state.sessionEndTime=t+this.state.sessionMinutes*60*1e3,this.updateSessionDisplay(),this.dom.startBtn.textContent="Stop",this.dom.startBtn.classList.add("stop"),this.dom.circle.style.transform="scale(0.35)",this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.soundscapeContext||(this.soundscapeContext=new(window.AudioContext||window.webkitAudioContext)),this.soundscapeContext.state==="suspended"&&await this.soundscapeContext.resume(),await this.requestWakeLock(),this.startBreathing(),this.playBackgroundSound(),this.resetIdleTimer()}stop(){this.state.isRunning=!1,this.state.animationFrameId!==null&&cancelAnimationFrame(this.state.animationFrameId),this.dom.startBtn.textContent="Start",this.dom.startBtn.classList.remove("stop"),this.dom.circle.className="circle stopped",this.dom.circle.style.removeProperty("--scale"),this.state.sessionEndTime=null,this.updateSessionDisplay(),this.animateText("Box Breathing"),this.dom.countdown.textContent="",this.dom.progressCircle.style.strokeDashoffset=this.config.circleCircumference.toString(),this.stopBackgroundSound(),this.releaseWakeLock()}startBreathing(){this.state.phaseStartTime=performance.now(),this.state.currentPhase=-1,this.nextPhase(),this.loop()}loop(){if(!this.state.isRunning)return;const e=(performance.now()-this.state.phaseStartTime)/1e3;e>=this.state.baseDuration?this.nextPhase():this.updateUI(e),this.state.animationFrameId=requestAnimationFrame(()=>this.loop())}nextPhase(){const t=this.config.presets.find(i=>i.id===this.state.currentPresetId);this.state.currentPhase=(this.state.currentPhase+1)%t.phases.length,this.state.phaseStartTime=performance.now();const e=t.phaseClasses[this.state.currentPhase];this.dom.circle.className=`circle ${e} `,this.dom.circle.style.setProperty("--dur",`${this.state.baseDuration}s`),this.dom.circle.style.removeProperty("--scale"),this.animateText(t.phases[this.state.currentPhase]);try{this.playPhaseSound(this.state.currentPhase),(this.state.currentPhase===0||this.state.currentPhase===2)&&this.playDeepPush(),this.triggerHaptic()}catch(i){console.warn("Audio feedback error:",i)}}updateUI(t){const e=Math.max(0,this.state.baseDuration-t);this.dom.countdown.textContent=Math.ceil(e).toString()||"";const i=t/this.state.baseDuration,s=Math.max(0,Math.min(1,i)),n=this.config.presets.find(u=>u.id===this.state.currentPresetId),a=n.phases[this.state.currentPhase];let o=.35;if(a==="Inhale")o=.35+.65*this.easeInOut(s);else if(a==="Exhale")o=1-.65*this.easeInOut(s);else if(a==="Hold"){const u=(this.state.currentPhase-1+n.phases.length)%n.phases.length;n.phases[u]==="Inhale"?o=1+.02*Math.sin(t*2.5):o=.35+.01*Math.sin(t*2.5)}this.dom.circle.style.transform=`scale(${o}) translateZ(0)`;const l=this.state.baseDuration*n.phases.length,d=(this.state.currentPhase*this.state.baseDuration+t)/l,r=this.config.circleCircumference*(1-d);if(this.dom.progressCircle.style.strokeDashoffset=r.toString(),this.state.sessionEndTime){const u=performance.now();if(Math.max(0,Math.ceil((this.state.sessionEndTime-u)/1e3))<=0){this.updateStreak(),this.stop();return}this.updateSessionDisplay()}}playPhaseSound(t){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination);const s=this.audioContext.currentTime,a=this.config.presets.find(o=>o.id===this.state.currentPresetId).phases[t];i.gain.setValueAtTime(0,s),i.gain.linearRampToValueAtTime(.3,s+.1),i.gain.exponentialRampToValueAtTime(.001,s+1.5),e.type="sine",a==="Inhale"?e.frequency.value=174.61:a==="Exhale"?e.frequency.value=130.81:e.frequency.value=146.83,e.start(s),e.stop(s+1.5)}playBackgroundSound(){if(this.stopBackgroundSound(),this.state.currentSoundscapeId==="none"||!this.soundscapeContext||this.state.isMuted)return;this.soundscapeContext.state==="suspended"&&this.soundscapeContext.resume();const t=this.soundscapeContext;this.soundscapeGain=t.createGain(),this.soundscapeGain.connect(t.destination),this.soundscapeGain.gain.value=.05,this.state.currentSoundscapeId==="rain"?this.createPinkNoise(t,this.soundscapeGain):this.state.currentSoundscapeId==="beach"&&this.createBrownNoise(t,this.soundscapeGain)}stopBackgroundSound(){var t;if(this.soundscapeGain){const e=((t=this.soundscapeContext)==null?void 0:t.currentTime)||0;this.soundscapeGain.gain.exponentialRampToValueAtTime(1e-4,e+.5),setTimeout(()=>{var i;(i=this.soundscapeSource)==null||i.disconnect(),this.soundscapeSource=null,this.soundscapeGain=null},600)}}createPinkNoise(t,e){const i=2*t.sampleRate,s=t.createBuffer(1,i,t.sampleRate),n=s.getChannelData(0);let a,o,l,p,d,r,u;a=o=l=p=d=r=u=0;for(let y=0;y<i;y++){const h=Math.random()*2-1;a=.99886*a+h*.0555179,o=.99332*o+h*.0750759,l=.969*l+h*.153852,p=.8665*p+h*.3104856,d=.55*d+h*.5329522,r=-.7616*r-h*.016898,n[y]=a+o+l+p+d+r+u+h*.5362,n[y]*=.11,u=h*.115926}const g=t.createBufferSource();g.buffer=s,g.loop=!0;const f=t.createBiquadFilter();f.type="lowpass",f.frequency.value=800,g.connect(f),f.connect(e),g.start(0),this.soundscapeSource=g}createBrownNoise(t,e){const i=2*t.sampleRate,s=t.createBuffer(1,i,t.sampleRate),n=s.getChannelData(0);let a=0;for(let r=0;r<i;r++){const u=Math.random()*2-1;n[r]=(a+.02*u)/1.02,a=n[r],n[r]*=3.5}const o=t.createBufferSource();o.buffer=s,o.loop=!0;const l=t.createOscillator();l.type="sine",l.frequency.value=.1;const p=t.createGain();p.gain.value=.3;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=400,o.connect(d),d.connect(e),o.start(0),this.soundscapeSource=o}toggleAudio(){this.state.isMuted=!this.state.isMuted,this.dom.audioBtn.classList.toggle("muted",this.state.isMuted);const t=this.state.isMuted?"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z":"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z";this.dom.audioBtn.querySelector("path").setAttribute("d",t),this.state.isMuted?this.stopBackgroundSound():this.playBackgroundSound()}playDeepPush(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&this.audioContext.resume();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination);const i=this.audioContext.currentTime;t.frequency.setValueAtTime(150,i),t.frequency.exponentialRampToValueAtTime(50,i+.15),e.gain.setValueAtTime(0,i),e.gain.linearRampToValueAtTime(.8,i+.02),e.gain.exponentialRampToValueAtTime(.001,i+.5),t.start(i),t.stop(i+.5)}triggerHaptic(){const t=this.state.currentPhase===0||this.state.currentPhase===2,e=[30];navigator.vibrate&&navigator.vibrate(e),!navigator.vibrate&&this.audioContext&&!this.state.isMuted&&this.playHapticSound(t)}playHapticSound(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.frequency.value=60;const s=this.audioContext.currentTime,n=t?.08:.04;i.gain.setValueAtTime(0,s),i.gain.linearRampToValueAtTime(1,s+.01),i.gain.exponentialRampToValueAtTime(.01,s+n),e.start(s),e.stop(s+n)}requestWakeLock(){if("wakeLock"in navigator)try{navigator.wakeLock.request("screen")}catch{}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release()}toggleSettings(t){t?this.dom.settingsOverlay.classList.remove("hidden"):this.dom.settingsOverlay.classList.add("hidden")}initZenModeListener(){this.idleTimer=null;const t=()=>this.resetIdleTimer();["mousemove","mousedown","touchstart","click","keydown"].forEach(e=>document.addEventListener(e,t,{passive:!0}))}resetIdleTimer(){document.body.classList.remove("zen-mode"),this.idleTimer&&clearTimeout(this.idleTimer),this.state.isRunning&&this.state.isZenModeEnabled&&(this.idleTimer=setTimeout(()=>{document.body.classList.add("zen-mode")},5e3))}animateText(t){const e=this.dom.phaseText;e.classList.add("text-fade-out"),setTimeout(()=>{e.textContent=t,e.classList.remove("text-fade-out"),e.classList.add("text-fade-in"),setTimeout(()=>e.classList.remove("text-fade-in"),500)},250)}easeInOut(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}loadStreak(){const t=localStorage.getItem("boxBreathingStreak"),e=localStorage.getItem("boxBreathingLastVisit");t&&(this.state.streak=parseInt(t,10)),e&&(this.state.lastVisit=e),this.updateStreakDisplay()}updateStreak(){const t=new Date().toDateString();if(this.state.lastVisit!==t){const e=new Date;e.setDate(e.getDate()-1),this.state.lastVisit===e.toDateString()?this.state.streak++:this.state.streak=1,this.state.lastVisit=t,localStorage.setItem("boxBreathingStreak",this.state.streak.toString()),localStorage.setItem("boxBreathingLastVisit",this.state.lastVisit),this.updateStreakDisplay()}}updateStreakDisplay(){this.state.streak>0?(this.dom.streakBadge.classList.remove("hidden"),this.dom.streakCount.textContent=this.state.streak.toString()):this.dom.streakBadge.classList.add("hidden")}}new S;
