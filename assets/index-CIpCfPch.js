var h=Object.defineProperty;var l=(o,t,e)=>t in o?h(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>l(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class u{constructor(){a(this,"dom");a(this,"lastMouseX");a(this,"lastMouseY");a(this,"state");a(this,"config");a(this,"wakeLock");a(this,"audioContext");a(this,"lastTapTime");a(this,"longPressTimer");a(this,"idleTimer");this.dom={circle:document.getElementById("circle"),countdown:document.getElementById("countdown"),decreaseBtn:document.getElementById("decrease-btn"),increaseBtn:document.getElementById("increase-btn"),durationDisplay:document.getElementById("duration-display"),startBtn:document.getElementById("start-btn"),audioBtn:document.getElementById("audio-btn"),phaseText:document.getElementById("phase-text"),progressCircle:document.querySelector(".progress-ring circle"),sessionTimer:document.getElementById("session-timer"),settingsOverlay:document.getElementById("settings-overlay"),settingsBtn:document.getElementById("settings-btn"),closeSettingsBtn:document.getElementById("close-settings-btn"),zenModeToggle:document.getElementById("zen-mode-toggle"),streakBadge:document.getElementById("streak-badge"),streakCount:document.querySelector(".streak-count")},this.lastMouseX=0,this.lastMouseY=0,this.lastTapTime=0,this.state={isRunning:!1,isMuted:!1,baseDuration:6,currentPhase:0,phaseStartTime:0,animationFrameId:null,sessionMinutes:15,sessionEndTime:null,isZenModeEnabled:!1,streak:0,lastVisit:null},this.config={phases:["Inhale","Hold","Exhale","Hold"],phaseClasses:["inhale","hold","exhale","hold-small"],frequencies:[261.63,392,329.63,196],circleCircumference:283},this.wakeLock=null,this.audioContext=null,this.longPressTimer=null,this.idleTimer=null,this.init(),this.loadStreak()}init(){this.dom.sessionTimer.innerHTML=`
            <span class="timer-control" data-action="decrease">âˆ’</span>
            <span id="session-time-display">15:00</span>
            <span class="timer-control" data-action="increase">+</span>
        `,this.dom.sessionTimeDisplay=document.getElementById("session-time-display"),this.addEventListeners(),this.updateDisplay(),this.updateSessionDisplay(),this.initZenModeListener()}addEventListeners(){this.dom.startBtn.addEventListener("click",()=>this.toggle()),this.dom.audioBtn.addEventListener("click",()=>this.toggleAudio()),this.dom.decreaseBtn.addEventListener("click",()=>this.changeDuration(-.5)),this.dom.increaseBtn.addEventListener("click",()=>this.changeDuration(.5)),document.addEventListener("keydown",e=>e.key==="Enter"&&this.dom.startBtn.click());const t=async()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume();const e=this.audioContext.createBuffer(1,1,22050),s=this.audioContext.createBufferSource();s.buffer=e,s.connect(this.audioContext.destination),s.start(0),document.body.removeEventListener("touchstart",t),document.body.removeEventListener("click",t)};document.body.addEventListener("touchstart",t,{once:!0}),document.body.addEventListener("click",t,{once:!0}),document.body.addEventListener("keydown",t,{once:!0}),this.dom.sessionTimer.addEventListener("click",e=>{const s=e.target;s.dataset.action==="decrease"&&this.adjustSessionTime(-5),s.dataset.action==="increase"&&this.adjustSessionTime(5)}),this.addLongPressListener(this.dom.circle,()=>this.startSession(15)),this.dom.circle.addEventListener("touchstart",e=>{const s=new Date().getTime(),i=s-this.lastTapTime;i<300&&i>0&&(this.startSession(15),e.preventDefault()),this.lastTapTime=s}),this.dom.settingsBtn.addEventListener("click",()=>this.toggleSettings(!0)),this.dom.closeSettingsBtn.addEventListener("click",()=>this.toggleSettings(!1)),this.dom.settingsOverlay.addEventListener("click",e=>{e.target===this.dom.settingsOverlay&&this.toggleSettings(!1)}),this.dom.zenModeToggle.addEventListener("change",e=>{const s=e.target;this.state.isZenModeEnabled=s.checked,this.resetIdleTimer()}),this.dom.circle.addEventListener("dblclick",()=>this.startSession(15))}addLongPressListener(t,e){const s=()=>{this.longPressTimer=setTimeout(()=>{e(),this.triggerHaptic()},1500)},i=()=>{this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)};t.addEventListener("touchstart",s,{passive:!0}),t.addEventListener("touchend",i),t.addEventListener("touchmove",i),t.addEventListener("mousedown",s),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i)}adjustSessionTime(t){if(this.state.sessionMinutes+=t,this.state.sessionMinutes<1&&(this.state.sessionMinutes=1),this.state.isRunning&&this.state.sessionEndTime){this.state.sessionEndTime+=t*60*1e3;const e=performance.now();this.state.sessionEndTime<e+1e4&&(this.state.sessionEndTime=e+1e4)}this.updateSessionDisplay(),this.triggerHaptic()}updateSessionDisplay(){let t=this.state.sessionMinutes,e=0;if(this.state.isRunning&&this.state.sessionEndTime){const i=performance.now(),n=Math.max(0,Math.ceil((this.state.sessionEndTime-i)/1e3));t=Math.floor(n/60),e=n%60}const s=`${t}:${e.toString().padStart(2,"0")} `;this.dom.sessionTimeDisplay&&(this.dom.sessionTimeDisplay.textContent=s)}startSession(t){this.state.sessionMinutes=t,this.updateSessionDisplay(),this.start()}changeDuration(t){const e=this.state.baseDuration;let s=e+t;if(s=Math.max(3,Math.min(30,s)),s!==e&&(this.state.baseDuration=s,this.updateDisplay(),this.state.isRunning)){const i=performance.now(),r=(i-this.state.phaseStartTime)/1e3/e;this.state.phaseStartTime=i-r*this.state.baseDuration*1e3}}updateDisplay(){this.dom.durationDisplay.textContent=`${this.state.baseDuration.toFixed(1)} s`}async toggle(){this.state.isRunning?this.stop():await this.start()}async start(){this.state.isRunning=!0;const t=performance.now();this.state.sessionEndTime=t+this.state.sessionMinutes*60*1e3,this.updateSessionDisplay(),this.dom.startBtn.textContent="Stop",this.dom.startBtn.classList.add("stop"),this.dom.circle.style.transform="scale(0.35)";try{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&await this.audioContext.resume()}catch(e){console.error("Audio init error:",e)}await this.requestWakeLock(),this.startBreathing(),this.resetIdleTimer()}stop(){this.state.isRunning=!1,this.state.animationFrameId!==null&&cancelAnimationFrame(this.state.animationFrameId),this.dom.startBtn.textContent="Start",this.dom.startBtn.classList.remove("stop"),this.dom.circle.className="circle stopped",this.dom.circle.style.removeProperty("--scale"),this.state.sessionEndTime=null,this.updateSessionDisplay(),this.animateText("Box Breathing"),this.dom.countdown.textContent="",this.dom.progressCircle.style.strokeDashoffset=this.config.circleCircumference.toString(),this.releaseWakeLock()}startBreathing(){this.state.phaseStartTime=performance.now(),this.state.currentPhase=-1,this.nextPhase(),this.loop()}loop(){if(!this.state.isRunning)return;const e=(performance.now()-this.state.phaseStartTime)/1e3;e>=this.state.baseDuration?this.nextPhase():this.updateUI(e),this.state.animationFrameId=requestAnimationFrame(()=>this.loop())}nextPhase(){this.state.currentPhase=(this.state.currentPhase+1)%this.config.phases.length,this.state.phaseStartTime=performance.now();const t=this.config.phaseClasses[this.state.currentPhase];this.dom.circle.className=`circle ${t} `,this.dom.circle.style.setProperty("--dur",`${this.state.baseDuration}s`),this.dom.circle.style.removeProperty("--scale");const e=this.config.phases[this.state.currentPhase];this.animateText(e);try{this.playPhaseSound(),this.playDeepPush(),this.triggerHaptic()}catch(s){console.warn("Audio feedback error:",s)}}easeInOut(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}updateUI(t){const e=Math.max(0,this.state.baseDuration-t);this.dom.countdown.textContent=Math.ceil(e).toString()||"";const s=t/this.state.baseDuration,i=Math.max(0,Math.min(1,s));let n=.35;this.state.currentPhase===0?n=.35+.65*this.easeInOut(i):this.state.currentPhase===2?n=1-.65*this.easeInOut(i):this.state.currentPhase===1?n=1+.02*Math.sin(t*2.5):this.state.currentPhase===3&&(n=.35+.01*Math.sin(t*2.5)),this.dom.circle.style.transform=`scale(${n}) translateZ(0)`;const r=(this.state.currentPhase+s)/this.config.phases.length,d=this.config.circleCircumference*(1-r);if(this.dom.progressCircle.style.strokeDashoffset=d.toString(),this.state.sessionEndTime){const c=performance.now();if(Math.max(0,Math.ceil((this.state.sessionEndTime-c)/1e3))<=0){this.updateStreak(),this.stop();return}this.updateSessionDisplay()}}loadStreak(){const t=localStorage.getItem("boxBreathingStreak"),e=localStorage.getItem("boxBreathingLastVisit");t&&(this.state.streak=parseInt(t,10)),e&&(this.state.lastVisit=e),this.updateStreakDisplay()}updateStreak(){const t=new Date().toDateString(),e=this.state.lastVisit;if(e!==t){if(e){const s=new Date;s.setDate(s.getDate()-1),e===s.toDateString()?this.state.streak++:this.state.streak=1}else this.state.streak=1;this.state.lastVisit=t,localStorage.setItem("boxBreathingStreak",this.state.streak.toString()),localStorage.setItem("boxBreathingLastVisit",this.state.lastVisit),this.updateStreakDisplay()}}updateStreakDisplay(){this.state.streak>0?(this.dom.streakBadge.classList.remove("hidden"),this.dom.streakCount.textContent=this.state.streak.toString()):this.dom.streakBadge.classList.add("hidden")}animateText(t){const e=this.dom.phaseText;e.classList.add("text-fade-out"),setTimeout(()=>{e.textContent=t,e.classList.remove("text-fade-out"),e.classList.add("text-fade-in"),setTimeout(()=>e.classList.remove("text-fade-in"),500)},250)}async playPhaseSound(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&await this.audioContext.resume();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.value=this.config.frequencies[this.state.currentPhase],t.type="sine",e.gain.cancelScheduledValues(this.audioContext.currentTime),e.gain.setValueAtTime(0,this.audioContext.currentTime),e.gain.linearRampToValueAtTime(.5,this.audioContext.currentTime+.1),e.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+3),t.start(),t.stop(this.audioContext.currentTime+2)}async playDeepPush(){if(!this.audioContext||this.state.isMuted)return;this.audioContext.state==="suspended"&&await this.audioContext.resume();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination);const s=this.audioContext.currentTime;t.frequency.setValueAtTime(150,s),t.frequency.exponentialRampToValueAtTime(50,s+.15),e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(.8,s+.02),e.gain.exponentialRampToValueAtTime(.001,s+.5),t.start(s),t.stop(s+.5)}triggerHaptic(){const t=this.state.currentPhase===0||this.state.currentPhase===2,e=t?[60]:[30];navigator.vibrate&&navigator.vibrate(e),!navigator.vibrate&&this.audioContext&&!this.state.isMuted&&this.playHapticSound(t)}playHapticSound(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination),e.frequency.value=60;const i=this.audioContext.currentTime,n=t?.08:.04;s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(1,i+.01),s.gain.exponentialRampToValueAtTime(.01,i+n),e.start(i),e.stop(i+n)}toggleAudio(){var e;this.state.isMuted=!this.state.isMuted,this.dom.audioBtn.classList.toggle("muted",this.state.isMuted);const t=this.state.isMuted?"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z":"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z";this.dom.audioBtn.querySelector("path").setAttribute("d",t),!this.state.isMuted&&!this.audioContext&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),!this.state.isMuted&&((e=this.audioContext)==null?void 0:e.state)==="suspended"&&this.audioContext.resume()}async requestWakeLock(){if("wakeLock"in navigator)try{this.wakeLock=await navigator.wakeLock.request("screen")}catch(t){console.log(`${t.name}, ${t.message} `)}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release().then(()=>{this.wakeLock=null})}toggleSettings(t){t?this.dom.settingsOverlay.classList.remove("hidden"):this.dom.settingsOverlay.classList.add("hidden")}initZenModeListener(){this.idleTimer=null;const t=()=>this.resetIdleTimer();["mousemove","mousedown","touchstart","click","keydown"].forEach(e=>{document.addEventListener(e,t,{passive:!0})})}resetIdleTimer(){document.body.classList.remove("zen-mode"),this.idleTimer&&clearTimeout(this.idleTimer),this.state.isRunning&&this.state.isZenModeEnabled&&(this.idleTimer=setTimeout(()=>{document.body.classList.add("zen-mode")},5e3))}}new u;
